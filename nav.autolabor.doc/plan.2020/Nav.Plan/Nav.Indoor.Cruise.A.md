# 室内小车巡航算法A

## 一、导航目标

小车避开障碍物在室内路面上巡航。

## 二、导航组件

### 1. 硬件模块

| 功能模块         | 硬件支持      | 型号          | 详细                 |
| ---------------- | ------------- | ------------- | -------------------- |
| 空间定位         | Motor&Encoder | Mega2560      | 驱动马达和电机编码器 |
| 姿态反馈         | Motor&Encoder | Mega2560      | 驱动马达和电机编码器 |
| 行驶方向路况采集 | Camera        | Howell-Hi3516 | 摄像机               |
| 四周行车路况采集 | /             | /             | /                    |
| 车轮驱动系统     | Motor&Encoder | Mega2560      | 驱动马达和电机编码器 |

#### 1.1 空间定位

##### 功能简介

​		空间定位模块用于确定小车在空间中的位置。

​		本项目为室内平面小车。小车行驶在二维[笛卡尔坐标系](https://baike.baidu.com/item/笛卡尔坐标系)中。

##### 传感器

​		/。

#### 1.2姿态反馈

##### 功能简介

​		用于确定导航车的姿态信息。导航车姿态包含俯仰（pitch）、滚转（roll）、偏航（yaw）。欧拉角（姿态角）用以确保导航车处于 正确的行驶方向。

##### 传感器

​		本项目为室内平面小车。没有俯仰（pitch）、滚转（roll）。姿态反馈依赖于Motor&Encoder动态计算。

#### 1.3行驶方向路况采集

##### 功能简介

​		导航车必须能够识别道路及道路上的路况，在无障碍物的路面上向前行驶，因此在行驶方向上必须能检测到足够远的障碍物。

##### 传感器

​		本项目使用摄像机分析路况。采用空间识别相机识别路面及路面障碍物。摄像机为极坐标原点，小车前进方向为极轴，障碍物坐标为极坐标（ρ，θ）；

#### 1.4四周行车路况采集

##### 功能简介

​		导航车行驶过程中需要与左右车辆或障碍物保持一定的安全距离。

##### 传感器

​		雷达测距。

#### 1.5车轮驱动系统

功能简介

​		驱动导航车运动，同时反馈导航车的运动状态（即，速度矢量、行驶里程）。

传感器

​		[Mega2560](https://baike.baidu.com/item/Mega2560/973064?fr=aladdin)驱动板，测速编码器。

模块

​		本项目使用[Mega2560](https://baike.baidu.com/item/Mega2560/973064?fr=aladdin)驱动小车运动。并结合小车轴距、轮胎大小动态计算小车位姿。

### 2. 软件模块

| 功能模块     |                                                              |
| ------------ | ------------------------------------------------------------ |
| 位置姿态控制 | /                                                            |
| 视觉图像分析 | /                                                            |
| 运动控制     | ROS Package [ros_arduino_bridge](https://wiki.ros.org/ros_arduino_bridge) |
| ~~雷达测距~~ |                                                              |
| 构建地图     | ROS Package [gmapping](http://wiki.ros.org/action/fullsearch/gmapping?action=fullsearch&context=180&value=linkto%3A"gmapping") |
| 路径规划     | ROS Package [move_base](http://wiki.ros.org/action/fullsearch/move_base?action=fullsearch&context=180&value=linkto%3A"move_base") |

#### 2.1位置姿态控制

​		导航车感知自身位姿，确保行车安全。能够根据目标线路迅速调整偏航角。协助完成路径规划。



#### 2.2视觉图像分析

​		图像分析识别路面及路面障碍物。确定障碍物的相对位置（比如，极坐标系下的角度θ和距离ρ），同时在地图上动态构建障碍物。协助完成本地实时路径规划。

#### 2.3运动控制

​			控制小车按照给定的速度矢量运动，同时反馈当前的速度矢量。协助完成运动规划。

##### ROS

​		[ros_arduino_bridge](https://wiki.ros.org/ros_arduino_bridge)这个堆栈包括一个ROS驱动程序和arduino兼容的微控制器的基本控制器。可以获得里程计数据

```
This stack includes a ROS driver and base controller for Arduino-compatible microcontrollers. The driver provides access to analog and digital sensors, PWM servos, and odometry data from encoders. It is meant to be a complete solution for running an Arduino-controlled robot under ROS.
```

#### 2.4雷达测距

​		确定近距离内的障碍物。同时在地图上动态构建障碍物。协助完成本地实时路径规划。

#### 2.5构建地图

​		本项目是平面小车。地图为二维笛卡尔坐标系下的室内平面地图。

##### 坐标系

​		开机后，小车所在位置为平面坐标系零点。车头方向为Y正轴。垂直于车头向右方向为X正轴。

##### 定位

​		开机后，小车所在位置为平面坐标系零点。

##### 2.5.1静态地图

​		静态地图是指那些静止车辆驶入的河流、山川、建筑，墙体，草坪等。静态地图获取方式主要是测绘。

| 地图类型           | 地图坐标系                                                   | 来源     |
| ------------------ | ------------------------------------------------------------ | -------- |
| 室内或厂区平面地图 | 二维[笛卡尔坐标系](https://zh.wikipedia.org/wiki/笛卡尔坐标系) | 自行测绘 |

##### 2.5.2动态地图

​		行驶过程中利用传感器动态发现近距离障碍物。并将障碍物添加到地图中，用于本地实时路径规划。

​		传感器主要有视觉传感器。雷达测距传感器等。

​		障碍物可以是的路中央的花坛，两边的围栏、隧道墙体等，也可以是临时放置的水马围挡等路障，或者是正在行驶的车辆、路边行走和过马路的行人。

#### 2.6路径规划

##### 2.6.1全局路径规划（global planner）

​		根据给定的目标位置进行总体路径的规划。

##### 2.6.2本地实时规划（local planner）

​		根据附近的障碍物进行躲避路线规划。