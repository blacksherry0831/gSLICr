# 室内地图构图

## 一、静态地图

### 地图格式**PGM**

​		PGM 是便携式灰度图像格式(portable graymap file format)。

​		文件的后缀名为”.pgm”,PGM格式图像格式分为两类:P2和P5类型。不管是P2还是P5类型的PGM文件,都由两部分组成,文件头部分和数据部分。

​			在黑白超声图像系统中经常使用PGM格式的图像。

### 地图描述文件

#### YAML format

```yaml
image: xxx.pgm
resolution: 0.050000
origin: [-13.800000, -15.400000, 0.000000]
negate: 0
occupied_thresh: 0.65
free_thresh: 0.196
```

#### Required fields:

- **image** : Path to the image file containing the occupancy data; can be absolute, or relative to the location of the YAML file
- **resolution** : Resolution of the map, meters / pixel
- **origin** : The 2-D pose of the lower-left pixel in the map, as (x, y, yaw), with yaw as counterclockwise rotation (yaw=0 means no rotation). Many parts of the system currently ignore yaw.
- **occupied_thresh** : Pixels with occupancy probability greater than this threshold are considered completely occupied.
- **free_thresh** : Pixels with occupancy probability less than this threshold are considered completely free.
- **negate** : Whether the white/black free/occupied semantics should be reversed (interpretation of thresholds is unaffected)

#### Optional parameter:

- **mode** : Can have one of three values: trinary, scale, or raw. Trinary is the default. More information on how this changes the value interpretation is in the next section.

### ROS

```xml
<!-- Map server -->
<arg name="map_file" default="$(env TURTLEBOT_MAP_FILE)"/>
<node name="map_server" pkg="map_server" type="map_server" args="$(arg map_file)" />
```

```shell
rosrun map_server map_server mymap.yaml
```



## 二、动态地图

ROS 中动态地图[costmap_2d](http://wiki.ros.org/action/fullsearch/costmap_2d?action=fullsearch&context=180&value=linkto%3A"costmap_2d")包括三部分Static Map Layer、Obstacle Map Layer、Inflation Layer。

### Layer Specifications

#### Static Map Layer

The [static map layer](http://wiki.ros.org/costmap_2d/hydro/staticmap) represents a largely unchanging portion of the costmap, like those generated by SLAM.

#### Obstacle Map Layer

The [obstacle layer](http://wiki.ros.org/costmap_2d/hydro/obstacles) tracks the obstacles as read by the sensor data. The `ObstacleCostmapPlugin` marks and raytraces obstacles in two dimensions, while the [VoxelCostmapPlugin](http://wiki.ros.org/costmap_2d/hydro/obstacles#VoxelCostmapPlugin) does so in three dimensions.

#### Inflation Layer

The [inflation layer](http://wiki.ros.org/costmap_2d/hydro/inflation) is an optimization that adds new values around lethal obstacles (i.e. inflates the obstacles) in order to make the costmap represent the configuration space of the robot.

### 全局动态（global_costmap）

​		Static Map Layer+Obstacle Map Layer+Inflation Layer

​		用于全局路径规划。使用[navfn](http://wiki.ros.org/action/fullsearch/navfn?action=fullsearch&context=180&value=linkto%3A"navfn")完成全局路径规划。

### 局部动态地图（local_costmap）

​		Static Map Layer+Obstacle Map Layer+Inflation Layer

​		用于局部路径规划。使用[dwa_local_planner](http://wiki.ros.org/action/fullsearch/dwa_local_planner?action=fullsearch&context=180&value=linkto%3A"dwa_local_planner")完成局部路径规划。

